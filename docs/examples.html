<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Graph</title>
    <script src="../vendor/pixi.min.js"></script>
    <script src="../vendor/greensock-js/TweenMax.min.js"></script>
    
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .graphfellow, .graph-container{
        width: 500px;
        height:300px;
        border:1px solid #ccc;
        display:inline-block;
      }

    </style>
  <body>
    <div id="other" class="graph-container" data-graph-config="background-color:0xffffcc"></div>
    <a href="example-graphs/regexp"><div class="graphfellow" data-graph-src="example-graphs/cs1870_fa_8.2.json"></div></a>
    <div class="graphfellow" data-graph-src="example-graphs/graph.json" data-graph-config="vertices.on_click:test01,tick-duration:0,vertices.text-font-size:30,vertices.is-pulse-blur:true"></div> 
    <div class="graphfellow" data-graph-src="example-graphs/graph.json"
    data-graph-config="vertices.pulse-duration:1,vertices.is_pulse_blur:true,vertices.pulse_scale:3,vertices.is_pulse_yoyo:false,background-color:0xccffcc,travellers.fill-color:0xffffff,vertices.fill-color:0xffffcc,vertices.stroke_width:8,vertices.stroke_color:0x009900,edges.is-arrow:true"></div>
    <div class="graphfellow" data-graph-src="example-graphs/gossip.json"></div>
    <div class="graphfellow" data-graph-src="example-graphs/solo.json" data-graph-config="background-color:0xffccff"></div>

    <script src="../graphfellow.js"></script>

    <script>
    
      GraphFellow.add_function("arrival", function(){
        alert("I am one of the " + this.json_type + " with payload " + this.payload.value);
      });
      GraphFellow.add_function("test01", function(){});
      
      let example_config = {
        vertices: [
          { id: "A", x: 300, y: 125 },
          { id: "B", x: 700, y: 125 },
          { id: "C", x: 700, y: 475 },
          { id: "D", x: 300, y: 475 }
        ],
        edges: [
          { from: "A", to: "B"},
          { from: "B", to: "C"},
          { from: "C", to: "D"},
          { from: "D", to: "A"},
          { from: "A", to: "C", is_bidirectional: true, journey_duration: 1.4},
          { from: "B", to: "D", is_bidirectional: true, journey_duration: 1.4}
        ],
        travellers: [
          { at_vertex: "A", radius: 20, on_arrival: "_pulse", fill_color: 0xff0000, stroke_color: 0xff0000 }
        ],
        config: {
          vertices: {
            stroke_width: 6,
            radius: 80,
            text_font_size: 60,
            has_pulse: true,
            pulse_scale: 1.1,
            is_pulse_blur: false
          },
          edges: {
            stroke_width: 6,
            arrowhead_length: 24
          },
          tick_period: 2,
          on_tick: "_send_travellers_on_all_random"
        }
      };
      GraphFellow.create_graph(document.getElementById("other"), example_config);

      // functions for CS 1870 finite automata

      let current = document.getElementById("regexp-current")
      let accepted = document.getElementById("regexp-accepted");
  
      GraphFellow.add_function("spot_arrives_at_next_state", function(e, graph){
        if (this.following_edge.payload.value != "Îµ") {
          this.payload.set(this.payload.value + this.following_edge.payload.value);
        }
        this.at_vertex.pulse();
        if (current) {
          current.innerHTML = "<span>" + this.payload.value + "</span>";
        }
        if (this.at_vertex.has_ring) {
          if (accepted) {
            accepted.innerHTML = "<span>" + this.payload.value + "</span>" + accepted.innerHTML;
          }
        }
      });

      GraphFellow.add_function("send_traveller_to_node", function(e, graph){
        let t = graph.travellers[0]; // find the (only) traveller
        if (t && t.at_vertex) { // only if the traveller is at rest
          let possible_edges = [];
          if (this.json_type === 'edges') {
            if (this.from === t.at_vertex) {
              possible_edges.push(this);
            }
          } else if (this.json_type === 'vertices') {
            for (let i =0; i < t.at_vertex.edges_out.length; i++) {
              if (t.at_vertex.edges_out[i].to === this) {
                possible_edges.push(t.at_vertex.edges_out[i]);
              }
            }
          }
          if (possible_edges.length === 1) {
            t.travel(possible_edges[0]);
          }
        }
      });
      GraphFellow.init(); // all graphs with class 'graphfellow' and data-graph-src
    </script>
  </body>
</html>
