<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<head>
  <title>demo of cascading graph</title>
<style>
  html, body {
    font-family: sans-serif;
    background-color:#ffffff;
    margin:0;
    padding:0;
  }
  .graphfellow {
    width: 100%;
    height:96vh;
    overflow:hidden;
  }
  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.0/pixi.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
<script src="../../graphfellow.js"></script>
</head>
<body>
<div class="graphfellow" data-graph-src="cascade.json" ></div>
<script>

  const max_cascade_depth = 6;
  const start_vertex_id = "00";

  GraphFellow.add_function("drop_new_marble", function(event, graph){
    let v = graph.get_vertex_by_id(start_vertex_id);
    v.payload.set(v.payload.value+1);
    v.pulse(event.type === 'tick'? 0x0000ff:0x00ff00); // green for tap/click
    graph.create_traveller({"at_vertex": v}).travel(v.get_random_edge_out());
  });

  GraphFellow.add_function("marble_arrives", function(event, graph){
    let t = this;
    t.at_vertex.payload.set(t.at_vertex.payload.value+1);
    if (t.qty_journeys < max_cascade_depth) {
      t.travel(t.at_vertex.get_random_edge_out());
    } else {
      t.at_vertex.pulse();
      t.destroy(); // alternatively, config could set journey_lifespan: 6
    }
  });

  GraphFellow.init();
</script>
</body>
</html>